## Adjust reat_test.py

If needed adjust: random vs sequential, use/not SLURM_TMPDIR


## How it was run

```{bash}
srun --ntasks-per-node=1 --nodes 1 --mem=10GB -t1:00:00 --pty /bin/bash

module purge
module load  anaconda3/5.3.1
conda activate <env_name>

python3
```

```{python}
exec(open("read_test.py").read())
```


## Results

Notes:   
* time to search file path by key is NOT included in time for reading from disk
* Every time for sequential read we start from new file (start_index) to not be affected by caching effect

### Time to extract data to SLURM_TMPDIR

Time to extract tar.gz file to $SLURM_TMPDIR 
500 - 1300 sec (~ 8-20 min)

Two trials below:

extracting process took (NOT included in total bellow): 529.3871302604675
copy lmdb file time (NOT included in total bellow): 458.6818673610687
copy hdf5 file time (NOT included in total bellow): 356.8990695476532


extracting process took (NOT included in total bellow): 500.2204577922821
copy lmdb file time (NOT included in total bellow): 63.31408166885376
copy hdf5 file time (NOT included in total bellow): 176.15278601646423




### Sequential, no conversion

{'lmdb': [0.06432604789733887, 0.00396728515625, 0.005461692810058594, 0.05142617225646973, 0.08241057395935059, 0.2405567169189453], 'hdf5': [0.15990304946899414, 0.0056231021881103516, 0.2408449649810791, 0.4909496307373047, 0.524146556854248, 1.436856746673584], 'SLURM_TMPDIR': [0.12251162528991699, 0.06373763084411621, 0.33519983291625977, 0.9905877113342285, 3.3342058658599854, 9.093150854110718], 'convert': [0, 0, 0, 0, 0, 0], 'subset_of_paths': [0.3470118045806885, 0.3285822868347168, 0.3275003433227539, 0.3411397933959961, 0.3328859806060791, 0.3398470878601074], 'lmdb_local': [0.00032448768615722656, 0.0007605552673339844, 0.0021805763244628906, 0.034549713134765625, 0.07451653480529785, 0.4810478687286377], 'hdf5_local': [0.02945733070373535, 0.004572153091430664, 0.013616800308227539, 0.03831124305725098, 0.14559364318847656, 0.3744211196899414], 'N_to_read': [100, 300, 1000, 3000, 10000, 30000]}
        lmdb   hdf5  SLURM_TMPDIR  lmdb_local  hdf5_local
100    0.064  0.160         0.123       0.000       0.029
300    0.004  0.006         0.064       0.001       0.005
1000   0.005  0.241         0.335       0.002       0.014
3000   0.051  0.491         0.991       0.035       0.038
10000  0.082  0.524         3.334       0.075       0.146
30000  0.241  1.437         9.093       0.481       0.374



## Sequential, conversion

{'lmdb': [0.13138651847839355, 0.06509590148925781, 0.2021162509918213, 0.6196367740631104, 2.0265157222747803, 5.991765737533569], 'hdf5': [0.10651516914367676, 0.0892031192779541, 0.4385802745819092, 1.084470510482788, 2.8753714561462402, 6.421825885772705], 'SLURM_TMPDIR': [0.16513514518737793, 0.1817021369934082, 0.4528942108154297, 1.4565513134002686, 5.131308555603027, 15.751207828521729], 'convert': [0.020757675170898438, 0.05907750129699707, 0.1916520595550537, 0.5709455013275146, 1.9117977619171143, 5.715641498565674], 'subset_of_paths': [0.3371760845184326, 0.3269329071044922, 0.3324763774871826, 0.3349602222442627, 0.3511228561401367, 0.4077577590942383], 'lmdb_local': [0.019670724868774414, 0.05960726737976074, 0.19729137420654297, 0.6082305908203125, 1.956817388534546, 6.027583122253418], 'hdf5_local': [0.04217100143432617, 0.06356668472290039, 0.20351314544677734, 0.6062986850738525, 2.0221450328826904, 6.598019361495972], 'N_to_read': [100, 300, 1000, 3000, 10000, 30000]}
        lmdb   hdf5  SLURM_TMPDIR  lmdb_local  hdf5_local
100    0.131  0.107         0.165       0.020       0.042
300    0.065  0.089         0.182       0.060       0.064
1000   0.202  0.439         0.453       0.197       0.204
3000   0.620  1.084         1.457       0.608       0.606
10000  2.027  2.875         5.131       1.957       2.022
30000  5.992  6.422        15.751       6.028       6.598



## Random, no coversion

{'lmdb': [2.6480519771575928, 6.254321813583374, 20.079705953598022], 'hdf5': [5.2335803508758545, 13.410952806472778, 34.81156015396118], 'SLURM_TMPDIR': [1.0473945140838623, 3.5066370964050293, 11.029919385910034], 'convert': [0, 0, 0], 'subset_of_paths': [0.3433041572570801, 0.3405439853668213, 0.35880088806152344], 'lmdb_local': [0.4854583740234375, 1.1060130596160889, 2.9706127643585205], 'hdf5_local': [0.5825412273406982, 1.4560730457305908, 1.8668668270111084], 'N_to_read': [100, 300, 1000]}
        lmdb    hdf5  SLURM_TMPDIR  lmdb_local  hdf5_local
100    2.648   5.234         1.047       0.485       0.583
300    6.254  13.411         3.507       1.106       1.456
1000  20.080  34.812        11.030       2.971       1.867

## Random, coversion

{'lmdb': [2.1793978214263916, 8.068297863006592, 23.665523767471313], 'hdf5': [3.6620731353759766, 9.72814154624939, 37.07906794548035], 'SLURM_TMPDIR': [1.0271978378295898, 3.0836360454559326, 9.798979759216309], 'convert': [0.02597212791442871, 0.07584524154663086, 0.2784717082977295], 'subset_of_paths': [0.3293941020965576, 0.34316468238830566, 0.3544890880584717], 'lmdb_local': [0.20773863792419434, 1.1070165634155273, 3.5010128021240234], 'hdf5_local': [0.43251872062683105, 1.0339949131011963, 1.3358707427978516], 'N_to_read': [100, 300, 1000]}
        lmdb    hdf5  SLURM_TMPDIR  lmdb_local  hdf5_local
100    2.179   3.662         1.027       0.208       0.433
300    8.068   9.728         3.084       1.107       1.034
1000  23.666  37.079         9.799       3.501       1.336






## Sequential access, parallel - no conversion to NumPy


{'lmdb': [2.8527822494506836, 0.6173934936523438, 1.8535752296447754, 1.3358535766601562, 1.43070650100708, 0.2882215976715088], 'hdf5': [2.9685206413269043, 0.7510066032409668, 1.9176933765411377, 1.8100028038024902, 2.3073599338531494, 2.220421314239502], 'lmdb_local': [2.87046217918396, 0.6000940799713135, 1.8250153064727783, 1.2350819110870361, 1.3441288471221924, 0.24516868591308594], 'hdf5_local': [3.3385579586029053, 0.6832499504089355, 2.031604528427124, 1.7322924137115479, 2.3492658138275146, 1.8298425674438477], 'SLURM_TMPDIR': [107.95755910873413, 0.7163519859313965, 1.9632365703582764, 1.5819671154022217, 1.8851642608642578, 1.2052943706512451], 'subset_of_paths': [0.15331125259399414, 0.1526944637298584, 0.14911627769470215, 0.15462851524353027, 0.1539628505706787, 0.15474748611450195], 'cpus_options': [16, 16, 8, 4, 2, 1]}
     lmdb   hdf5  lmdb_local  hdf5_local  SLURM_TMPDIR
16  2.853  2.969       2.870       3.339       107.958
16  0.617  0.751       0.600       0.683         0.716
8   1.854  1.918       1.825       2.032         1.963
4   1.336  1.810       1.235       1.732         1.582
2   1.431  2.307       1.344       2.349         1.885
1   0.288  2.220       0.245       1.830         1.205


